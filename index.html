<script type="module">
    import { checkLoginStatus, openLoginPopup } from './js/auth.js';
    import { supabase } from './js/supabaseClient.js';
    

    document.addEventListener('DOMContentLoaded', async () => {
    console.log('[DEBUG] Document fully loaded. Checking login status...');

    // ✅ Ensure Supabase is defined before calling it
    if (!window.supabase) {
        console.error("[DEBUG] Supabase is still undefined. Check script loading.");
        return;
    }

    // ✅ Force Supabase to use the stored session
    const storedSession = localStorage.getItem("supabase.auth.token");
    if (storedSession) {
        console.log("[DEBUG] Found stored session, forcing it into Supabase...");
        await supabase.auth.setSession(JSON.parse(storedSession));
    }

    // ✅ Now check session again
    const isLoggedIn = await checkLoginStatus();
    const loginButton = document.getElementById('loginButton');

    if (isLoggedIn) {
        console.log('[DEBUG] User is logged in.');
        loginButton.textContent = "Logout";
    } else {
        console.warn('[DEBUG] User is not logged in.');
        loginButton.textContent = "Login";
        loginButton.onclick = openLoginPopup;
    }
});

</script>
