<script type="module">
    import { checkLoginStatus, openLoginPopup } from './js/auth.js';
    import { supabase } from './js/supabaseClient.js';
    

    document.addEventListener('DOMContentLoaded', async () => {
    console.log('[DEBUG] üöÄ Document loaded. Checking login status...');

    if (!window.supabase) {
        console.error("[DEBUG] ‚ùå Supabase is undefined. Check script loading.");
        return;
    }

    // ‚úÖ Check if localStorage contains a session
    const storedSession = localStorage.getItem("supabase.auth.token");
    console.log("[DEBUG] üîç Checking localStorage before setting session:", storedSession);

    if (storedSession) {
        console.log("[DEBUG] ‚úÖ Found stored session. Forcing Supabase to use it...");
        const parsedSession = JSON.parse(storedSession);
        await supabase.auth.setSession(parsedSession);
    }

    // ‚úÖ Now check login status
    const isLoggedIn = await checkLoginStatus();
    const loginButton = document.getElementById('loginButton');

    if (isLoggedIn) {
        console.log('[DEBUG] ‚úÖ User is logged in.');
        loginButton.textContent = "Logout";
    } else {
        console.warn('[DEBUG] ‚ùå User is not logged in.');
        loginButton.textContent = "Login";
        loginButton.onclick = openLoginPopup;
    }
});



</script>
